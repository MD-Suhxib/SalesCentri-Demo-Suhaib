post:
  summary: Deduct Credits for Service Usage
  description: Deduct credits from user's organization wallet for using a service. Requires both user authentication (Bearer token) and API key (x-api-key header) for security. The service_key must exist in the service credit mappings and be active. The credit cost is automatically looked up from the mapping.
  operationId: deductCredits
  tags:
    - Credits
  parameters:
    - name: x-api-key
      in: header
      required: true
      schema:
        type: string
      description: API key for authorization (matches SALESCENTRI_CLIENT_API_KEY from .env)
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - service_key
          properties:
            service_key:
              type: string
              description: Service identifier (structured path like "dashboard/feature") that was configured in admin panel
              example: "dashboard/feature"
  responses:
    "200":
      description: Credits deducted successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: true
                description: Indicates if the request was successful
              data:
                type: object
                properties:
                  message:
                    type: string
                    example: "Credits deducted successfully"
                  service_key:
                    type: string
                    example: "dashboard/feature"
                    description: Service key that was used
                  service_name:
                    type: string
                    example: "Dashboard Feature Access"
                    description: Human-readable service name
                  credits_deducted:
                    type: integer
                    example: 10
                    description: Number of credits deducted
                  balance_before:
                    type: integer
                    example: 100
                    description: Wallet balance before deduction
                  balance_after:
                    type: integer
                    example: 90
                    description: Wallet balance after deduction
                required:
                  - message
                  - service_key
                  - service_name
                  - credits_deducted
                  - balance_before
                  - balance_after
              error:
                type: object
                nullable: true
    "400":
      description: Validation error or insufficient credits
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    examples:
                      - "service_key is required"
                      - "Service is not active"
                      - "Service has invalid credit cost"
                      - "Insufficient credits"
    "401":
      description: Unauthorized - Invalid or missing API key or authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 401
                  message:
                    type: string
                    examples:
                      - "Invalid API key"
                      - "Authentication required"
    "404":
      description: Service not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 404
                  message:
                    type: string
                    example: "Service not found"
    "500":
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 500
                  message:
                    type: string
                    example: "Failed to deduct credits"

