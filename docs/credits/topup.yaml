post:
  summary: Topup Credits
  description: Purchase credits using a credit plan. Requires both user authentication (Bearer token) and API key (x-api-key header) for security. This endpoint creates a payment record and immediately credits the user's organization wallet.
  operationId: topupCredits
  tags:
    - Credits
  parameters:
    - name: x-api-key
      in: header
      required: true
      schema:
        type: string
      description: API key for authorization (matches SALESCENTRI_CLIENT_API_KEY from .env)
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - plan_id
            - transaction_id
          properties:
            plan_id:
              type: integer
              description: Credit plan ID to purchase
            transaction_id:
              type: string
              description: Unique transaction ID from payment provider
            payment_provider:
              type: string
              enum: [payu, paypal, stripe, other]
              default: other
              description: Payment provider name (optional, defaults to 'other')
  responses:
    "200":
      description: Credits topped up successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: true
                description: Indicates if the request was successful
              data:
                type: object
                properties:
                  message:
                    type: string
                    example: "Credits topped up successfully"
                  payment:
                    type: object
                    properties:
                      id:
                        type: integer
                        description: Payment record ID
                      user_id:
                        type: integer
                        description: User ID who made the purchase
                      organization_id:
                        type: integer
                        description: Organization ID that received credits
                      plan_id:
                        type: integer
                        description: Credit plan ID
                      provider:
                        type: string
                        enum: [payu, paypal, stripe, other]
                        description: Payment provider
                      order_id:
                        type: string
                        description: Transaction ID from payment provider
                      provider_payment_id:
                        type: string
                        nullable: true
                        description: Payment ID from provider
                      amount:
                        type: number
                        format: decimal
                        description: Payment amount in USD
                      currency:
                        type: string
                        example: "USD"
                        description: Currency code
                      status:
                        type: string
                        enum: [created, authorized, captured, failed, refunded]
                        example: "captured"
                        description: Payment status
                      meta:
                        type: object
                        nullable: true
                        description: Additional metadata (JSON)
                      created_at:
                        type: string
                        format: date-time
                        description: Creation timestamp
                      updated_at:
                        type: string
                        format: date-time
                        description: Last update timestamp
                  credits_added:
                    type: integer
                    description: Number of credits added to wallet
                required:
                  - message
                  - payment
                  - credits_added
              error:
                type: object
                nullable: true
    "400":
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    examples:
                      - "plan_id is required"
                      - "transaction_id is required"
                      - "Invalid payment_provider. Must be one of: payu, paypal, stripe, other"
                      - "Plan is not active"
    "401":
      description: Unauthorized - Invalid or missing API key or authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 401
                  message:
                    type: string
                    examples:
                      - "Invalid API key"
                      - "Authentication required"
    "404":
      description: Plan not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 404
                  message:
                    type: string
                    example: "Plan not found"
    "500":
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: object
                nullable: true
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 500
                  message:
                    type: string
                    examples:
                      - "Server configuration error"
                      - "Failed to credit wallet"
                      - "Failed to topup credits"

